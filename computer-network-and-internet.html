<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=1">
<meta name="renderer" content="webkit">
<meta name="google" value="notranslate">
<meta name="robots" content="index,follow">


<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Feily Zhang">
<meta name="twitter:description" content="昨夜星辰昨夜风，画楼西畔桂堂东">
<meta name="twitter:image:src" content="https://feily.tech/images/mylogo.png">

<meta property="og:url" content="https://feily.tech">
<meta property="og:title" content="Feily Zhang">
<meta property="og:description" content="昨夜星辰昨夜风，画楼西畔桂堂东">
<meta property="og:site_name" content="Feily Zhang">
<meta property="og:image" content="https://feily.tech/images/mylogo.png">
<meta property="og:type" content="website">
<meta name="robots" content="noodp">

<meta itemprop="name" content="Feily Zhang">
<meta itemprop="description" content="昨夜星辰昨夜风，画楼西畔桂堂东">
<meta itemprop="image" content="https://feily.tech/images/mylogo.png">

<link rel="canonical" href="https://feily.tech">

<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-itouch-icon" href="/favicon.png">
<link rel="stylesheet" href="/bundle/index.css">
<script type="text/javascript">
    var timeSinceLang = {
        year: '年前',
        month: '个月前',
        day: '天前',
        hour: '小时前',
        minute: '分钟前',
        second: '秒前'
    };
    var root = '';
</script>

<script type="text/javascript">
    var conn, reloadTimer, connectTimer;
    var connect = function() {
        conn = new WebSocket('ws://' + location.host + '/live');
        conn.onmessage = function(event) {
            if (event.data === 'change') {
                if (reloadTimer) clearTimeout(reloadTimer);
                reloadTimer = setTimeout(function() {
                    window.location.reload();
                }, 200);
            }
        };
        conn.onclose = function() {
            if (connectTimer) clearTimeout(connectTimer);
            connectTimer = setTimeout(function() {
                connect();
            }, 1000);
        };
    };
    connect();
</script>


        <meta name="keywords" content="Computer Network,">
        <meta name="description" content="计算机网络和因特网">
        <meta name="author" content="奕清">
        <title>计算机网络和因特网</title>
    </head>
    <body>
        <article class="container">
            <header class="header-wrap" style="font-family:Simsun">
  <a class="index" href="/">
    <img class="logo" src="/images/mylogo.png" />
    Feily Zhang
  </a>
  <ul class="menu">
      <li class="menu-item"><a href="/archive.html">归档</a></li>
      <li class="menu-item"><a href="/about.me.html">关于</a></li>
      <li class="menu-item"><a href="/atom.xml">订阅</a></li>
  </ul>
</header>

            <article class="main article">
                <h1 class="title" style="font-family:Simsun">计算机网络和因特网</h1>
                <section class="info" style="font-family:KaiTi">
                    <span class="avatar" style="background-image: url(/images/mylogo.png);"></span>
                    <a class="name" href="/about.me.html">奕清</a>
                    
                    <span class="date" data-time="1579522754"><span class="from"></span></span>
                    
                    <span class="tags">Computer Network</span>
                </section>
                <article class="content" style="font-family:Kaiti"><h1>一、什么是因特网</h1>

<p>对这个问题的回答具有两种方式，分别是以因特网的具体构成和所提供的服务来描述。</p>

<h2>1.1 具体构成描述</h2>

<p>因特网是一个由主机(host)或端系统(end system)通过通信链路(communication link)和分组交换机(packet switch)连接到一起的世界范围的计算机网络。</p>

<ul>
<li>主机(host)或端系统(end system)：即终端设备，包括家用PC、Linux工作站、服务器、智能手机、平板电脑、电视、手表等。</li>
<li>通信链路(communication link)：即传输媒介，包括同轴电缆、铜线、光纤以及无线电频谱，不同的链路以不同的速率传输数据，链路的传输速率(transmission rate)以比特/秒(bit/s, 或bps)度量。</li>
<li>分组(packet)：即数据包，当一个端系统要向另一个端系统发送数据时，发送端将数据分段，并为每段加上首部字节，由此形成的信息包称之为分组。</li>
<li>分组交换机(packet switch)：其从它的入通信链路接受到达的分组，并从它的出通信链路转发该分组，主要包括路由器(router)和链路层交换机(link-layer switch)。</li>
<li>路径(route或path)：一个分组从发送端到接收端所经历的一系列通信链路和分组交换机称为通过该网络的路径。</li>
</ul>

<h2>1.2 服务描述</h2>

<p>因特网是为分布式应用程序(distributed application)提供(数据传输)服务的基础设施。</p>

<p>与因特网相连接的端系统提供了一个套接字接口(socket interface)，该接口规定了运行在端系统之上的应用程序请求因特网基础设施向另一个连接了因特网的端系统上的目的程序交付数据的方式。</p>

<h1>二、什么是协议</h1>

<p>协议(protocol)定义了两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其它事件所采取的动作。</p>

<p>简单来讲。协议就是通信实体之间的共识，以此保证实体之间通信(数据发送与接收)的一致性、完整性。</p>

<h1>三、从网络边缘到网络核心</h1>

<h2>3.1 网络边缘</h2>

<p>所谓网路边缘，即靠近端系统或主机的一侧，包括端系统(或主机)以及接入网。主机可被划分为客户端(client)和服务器(server)。如今，客户端包括桌面PC、移动PC以及智能手机等，而服务器则大都属于大型数据中心(data center)。</p>

<p>接入网指将端系统物理连接到其边缘路由器(edge router)的网络，边缘路由器是端系统到其它任何远程端系统的路径(path)上的第一台路由器。不同环境下的几种类型的接入链路如下。</p>

<h3>3.1.1 家庭接入：DSL、电缆、FTTH、拨号和卫星</h3>

<p>数字用户线(Digital Subscriber Line, DSL)接入方式下，用户从提供本地电话接入的本地电话公司(ISP)处获得DSL因特网接入，每个用户的DSL调制解调器使用现有的电话线(双绞铜线)与位于电话公司的本地中心局(co)中的数字用户线接入复用器(DSLAM)交换数据。家庭的DSL调制解调器得到数字数据后将其转换为高频音，以便通过电话线传输给本地中心局，来自许多家庭的模拟信号在DSLAM处被转换回数字形式。</p>

<p>电缆因特网接入(cable internet access)利用了有线电视公司现有的有线电视基础设施，用户从提供有线电视的公司处获得电缆因特网接入。光缆将电缆头端连接到地区枢纽，然后从这里使用传统的同轴电缆到达各家各户。由于在此系统中应用了光纤和同轴电缆，因此常被称作混合光纤同轴系统(Hybrid Fiber Coax, HFC)。与DSL一样，依然通过调制解调器转换信号。</p>

<p>光纤到户(Fiber To The Home, FTTH)是一种高速率的接入方式，其从本地中心局直接向家庭引入一条光纤路径。最简单的光线分布网络称为直接光纤，即从本地中心局向每户设置一条光纤，但更为一般的方案是从中心距出来的每根光纤实际上由许多家庭共享，直到相对接近这些家庭的位置时，该光纤才分成每户一根光纤。</p>

<p>而在一些无法提供DSL、电缆和FTTH的地方，可以使用卫星链路将用户以超过1Mbps的速率与因特网相连。另一种可选的方案是使用传统电话线的拨号接入，不过其速率慢得令人发指(56kbps)。</p>

<table>
<thead>
<tr>
<th>名称</th>
<th>ISP</th>
<th>传输介质</th>
<th>速率</th>
</tr>
</thead>

<tbody>
<tr>
<td>DSL</td>
<td>本地电话公司</td>
<td>电话线(双绞铜线)</td>
<td>较慢</td>
</tr>

<tr>
<td>电缆</td>
<td>有线电视公司</td>
<td>光纤和同轴电缆</td>
<td>较快</td>
</tr>

<tr>
<td>FTTH</td>
<td>本地中心局</td>
<td>光纤</td>
<td>快</td>
</tr>

<tr>
<td>卫星</td>
<td>卫星接入提供商</td>
<td>卫星</td>
<td>较快</td>
</tr>

<tr>
<td>拨号</td>
<td>同DSL</td>
<td>同DSL</td>
<td>最慢</td>
</tr>
</tbody>
</table>

<h3>3.1.2 企业(和家庭)接入：以太网和WiFi</h3>

<p>以太网用户使用双绞铜线与一台以太网交换机相连，以太网交换机或这样相连的交换机网络再与更大的因特网相连。以太网接入下速率可达到100Mbps或1Gbps，服务器甚至达到1Gbps甚至10Gbps。</p>

<p>在无线LAN环境中，无线用户从/到一个接入点发送/接收分组，该接入点与企业网连接，企业网再与有线因特网相连。</p>

<h3>3.1.3 广域无线接入3G、LTE、5G</h3>

<p>3G为分组交换广域无线因特网接入提供了超过1Mbps的速率；而LTE提供了下行为100Mbps，上行为50Mbps的速率；而5G下行峰值速率达到500Mbps及以上，最高上行速率约为100Mbps。</p>

<h3>3.1.4 传输媒体</h3>

<ul>
<li>双绞铜线：最便宜且最常用的导引型传输媒体，广泛适用于电话网；</li>
<li>同轴电缆：传输速率较高，广泛适用于电缆电视系统；</li>
<li>光纤：成本高、传输速率高、难窃听，广泛应用于因特网主干；</li>
<li>路基无线电信道：承载电磁频谱中的信号，具有穿透墙壁、提供与移动用户的连接以及长距离承载信号的能力；</li>
<li>卫星无线电信道：包括同步卫星(geostationary satellite)和近地轨道(Low-Earth Orbiting, LEO)卫星。</li>
</ul>

<h2>3.2 网络核心</h2>

<p>网络核心，即由互联因特网端系统的分组交换机和链路构成的网状网络。</p>

<p>在各种网络应用中，端系统之间彼此交换报文(message)，通常将报文划分为较小的数据块，称之为分组(packet)。在端系统之间，每个分组都通过通信链路和分组交换机(packet switch)传送。分组以等于该链路最大传输速率的速度传输。因此，如果某源端系统或者分组交换机经过一条链路发送一个L比特的分组，链路的传输速率为R比特/秒，则传输该分组的时间为<code>L/R</code>秒。</p>

<h3>3.2.1 存储转发传输</h3>

<p>多数分组交换机在链路的输入端使用存储转发传输(store-and-forward transmission)机制，指的是在交换机开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组，也就是说只有分组交换机接受完该分组的所有比特之后，它才可以向输出链路转发该分组。那么从源开始发送分组到目的地收到整个分组所经过的时间度量如下</p>

<ol>
<li>源在时刻t<sub>0</sub>开始传输,在时刻L/R秒源下的一个路由器正好接收到整个分组，所以该路由器可以朝着目的地向出链路开始传输分组；</li>
<li>那么在时刻<code>L/R + L/R</code>，即2L/R时上一个路由器已经完全转发了整个分组，即当前路由器(上一个路由器的下一个路由器)已经全部接收了分组；</li>
<li>&hellip;&hellip;</li>
</ol>

<p>那么可以归纳为：通过由N条速率均为R的链路组成的路径(即，源地址与目的地址之间存在N - 1台路由器)，从源到目的地发送一个分组，端到端的时延为
<p style="text-align:center">d<sub>端到端</sub> = N*L/R</p></p>

<h3>3.2.2 排队时延和分组丢失</h3>

<p>每台分组交换机有多条链路与之相连，对于每条相连的链路，该分组交换机具有一个输出缓存(output buffer)或输出队列(output queue)，其用于存储路由器准备发往那条链路的分组，如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，那么该到达分组必须在输出缓存中等待，也就是说分组还存在排队时延(queuing delay)，这个值的大小取决于网络的拥塞程度。如果对应链路的输出缓存满了怎么办？</p>

<p>在此情况下，将出现分组丢失(packet loss)，即丢包，意味着到达的分组或已经排队的分组之一将被丢弃。</p>

<h3>3.2.3 转发表和路由选择协议</h3>

<p>本质上说，路由器的功能就是转发，即通过合适的链路将输入传输出去，那么路由器如何知道那条链路是合适的呢？或者说，路由器怎样决定它应当向哪条链路进行转发？答案是路由表。</p>

<p>因特网中，每个端系统都有一个地址，即IP地址，当源向目的地发送一个分组时，在分组的首部包含了目的地的IP地址，更特别的是，每台路由器具有一个转发表(forwarding table)，用于将目的地址(或目的地址的一部分)映射为输出链路。当某个分组到达一台路由器时，路由器检查目的地址并搜索转发表以发现适当的出链路，然后将分组导出。</p>

<p>那么对本节问题的回答就是：<strong>路由器使用分组的目的地址索引转发表并决定适当的出链路。</strong></p>

<p>但是转发表如何设置呢？答案是<strong>因特网通过路由选择协议(routing protocol)自动地设置这些转发表。</strong></p>

<h1>四、网络性能测度：时延、丢包、吞吐</h1>

<h2>4.1 时延</h2>

<p>分组从源主机出发，通过一系列路由器传输，直至被目的主机接收到，其经过了几种不同类型的时延。分别为</p>

<ul>
<li>节点处理时延(nodal processing delay)：包括检查分组首部和决定将该分组导向何处所需的时间(也就是检查与查表的时间)、检查比特级别的差错所需的时间等；</li>
<li>排队时延(queuing delay)：在分组交换机输出缓存上等待传输的时间，其长度取决于先期到达的正在排队等待传输的分组数量。实际的排队时延可以是毫秒到微妙量级；</li>
<li>传输时延(transmission delay)：即分组被推向链路所需的时间(或路由器推出分组随需的时间)，其大小度量为<code>t = L / R</code>。例如分组比特长度L为50000，以太网链路速率R为10Mbps，那么该分组被路由器推向链路所需的传输时延为<code>50000 / 10Mbps = 50000 / 10 * 1024 * 1024 * 8 ≈ 0.6ms</code>。实际的传输时延通常在毫秒到微妙量级；</li>
<li>传播时延(propagation delay)：即在节点间(或路由器之间)的链路上传播所需的时间。链路的传播速率取决于链路的物理媒体，速率范围为2 * 10<sup>8</sup> - 3 * 10<sup>8</sup>m/s，等于或略小于光速，那么分组的传播时延等于两台路由器之间的距离除以传播速率，即<code>t = d / s</code>。在广域网中，传播时延为毫秒量级。</li>
</ul>

<p>综上，那么在节点之间的总时延可以由下式定义</p>

<p style="text-align:center">d<sub>nodal</sub> = d<sub>proc</sub> + d<sub>queue</sub> + d<sub>trans</sub> + d<sub>prop</sub></p>

<p>不同的链路中，上述时延成分所起的作用可能存在很大不同，有的甚至可以小到忽略不计或为0。</p>

<h2>4.2 排队时延与丢包</h2>

<p>排队时延与丢包密切相关，在排队时延足够大的情况下，会发生丢包。与其它三项时延不同的是，排队时延对不同的分组可能是不同的，。例如，如果10个分组同时到达空队列，那么传输的第一个分组没有排队时延(即为0)，而最后一个分组则要经受相当大的排队时延，排队时延的这种不平衡性通常使用统计量来度量。</p>

<p>排队时延的大小取决于流量到达该队列的速率、链路的传输速率和到达流量的性质(即流量是周期性到达还是突发性到达)。令a表示分组到达队列的平均速率(单位是分组/秒，即pkt/s)，R为传输速率，假定所有的分组长度为L比特，则比特到达队列的平均速率为La bps，最后再假定队列无限大，可以容纳无限多的比特，那么可以定义如下比率</p>

<p style="text-align:center">La / R</p>

<p>被称为流量强度(traffic intensity)。其作用是估计排队时延的大小范围。若流量强度大于1，那么说明分组比特到达队列的平均速率La大于分组比特被推向链路的速率，那么就会存在排队时延，那么在此情况下，久而久之，该队列的分组趋向于无限增加，同时，排队时延将趋向无限大。</p>

<p>如果流量强度小于等于1，那么此时到达流量的性质影响排队时延。如果分组周期性到达，即每L/R秒到达一个分组，则每个分组将到达一个空队列，不会有排队时延。另一方面，如果分组以突发形式到达而不是周期性到达，则可能产生很大的平均排队时延。</p>

<p><strong>总之，平均排队时延与流量强度成指数关系，即随着流量强度接近于1，平均排队时延趋于无穷大。</strong></p>

<p>丢包是伴随着输出缓存的满额而出现的，而在流量强度足够大的情况下输出缓存势必在及短的时间内满额。也就是说，当流量强度足够大时，会出现丢包。这就需要重传。</p>

<h2>4.3 端到端时延</h2>

<p>假设源主机到目的主机之间有N-1台路由器，即在数据链路上传输N次，并假设该网络无拥塞，即不存在排队时延，那么端到端时延被定义为</p>

<p style="text-align:center">d<sub>end-end</sub> = N(d<sub>proc</sub> + d<sub>trans</sub> + d<sub>prop</sub>)</p>

<p>Windows下可通过<code>tracert</code>命令查看端到端路由及时延，测试如下</p>

<pre><code>C:\Users\fei47&gt;tracert feily.tech

Tracing route to feily.tech [185.199.110.153]
over a maximum of 30 hops:

  1     1 ms     2 ms     1 ms  192.168.43.1
  2     *        *        *     Request timed out.
  3    53 ms    40 ms    79 ms  10.134.188.45
  4    59 ms    39 ms     *     10.134.188.9
  5     *        *        *     Request timed out.
  6   154 ms    55 ms    39 ms  120.192.243.105
  7     *        *        *     Request timed out.
  8   145 ms    98 ms    97 ms  221.176.20.109
  9     *      179 ms   200 ms  221.176.15.213
 10   106 ms    93 ms    60 ms  221.176.21.186
 11     *        *        *     Request timed out.
 12     *      354 ms  1048 ms  221.183.30.246
 13   346 ms   299 ms   346 ms  223.118.10.154
 14     *      351 ms   402 ms  38.19.140.57
 15   259 ms   271 ms     *     38.19.140.114
 16   255 ms     *      260 ms  185.199.110.153

Trace complete.
</code></pre>

<p>除过上述讨论的一些重要时延，端系统中还存在其它一些时延，比如应用程序层面的时延等。</p>

<h2>4.4 吞吐量</h2>

<p>对分组交换网络性能的测度的另一指标是端到端吞吐量。例如，考虑最简单的情况，源到目的地只经过一个路由器转发，源到路由器和目的地到路由器的传输速率分别为R<sub>s</sub>、R<sub>c</sub>，如下简单图示</p>

<p style="text-align:center">Host<sub>1</sub>--------R<sub>s</sub>--------Route--------R<sub>c</sub>--------Host<sub>2</sub></p>

<ul>
<li>若R<sub>s</sub> &gt; R<sub>c</sub>，那么路由器无法以接收比特的速率发送比特，在这种情况下比特将以速率R<sub>c</sub>离开该路由器，从而得到端到端吞吐量R<sub>c</sub>，同时在路由器缓存处积攒的比特数会越来越多；</li>
<li>若R<sub>s</sub> &lt; R<sub>c</sub>，那么路由器无法以发送比特的速率接收比特，即在给定吞吐量R<sub>s</sub>的情况下，比特将以速率R<sub>s</sub>离开该路由器，从而得到端到端吞吐量R<sub>s</sub>。</li>
</ul>

<p>那么，可以如下定义两链路的吞吐量</p>

<p style="text-align:center">min{R<sub>c</sub>, R<sub>s</sub>}</p>

<p>同理，在N链路网络中，这N条链路的传输速率分别是R<sub>1</sub>, R<sub>2</sub>, &hellip;, R<sub>n</sub>，那么N链路网络中吞吐量可以定义为</p>

<p style="text-align:center">min{R<sub>1</sub>, R<sub>2</sub>, ..., R<sub>n</sub>}</p>

<p>综上，<strong>数据链路网络中的吞吐量取决于端系统之间路径的瓶颈链路的传输速率。</strong></p>
</article>
                <section class="author" style="font-family:NSimSun">
                    <div class="avatar" style="background-image: url(/images/mylogo.png);"></div>
                    <a class="name" href="/about.me.html">奕清</a>
                    <div class="intro" style="font-family:KaiTi">听书，茶楼，下个巷口</div>
                </section>
                <section class="recommend" style="font-family:KaiTi">
                    
                    <section class="nav prev more">
                        <div class="head">上篇文章</div>
                        <a class="link" href="/computer-network-application-layer.html">计算机网络应用层</a>
                    </section>
                    
                    
                    <section class="nav next more">
                        <div class="head">下篇文章</div>
                        <a class="link" href="/adapt-to-32-bit-protection-mode-and-create-kernel-paging-mechanism.html">Linux内核源码分析：适应32位保护模式并创建内核分页机制</a>
                    </section>
                    
                </section>
                
            </article>
        </article>
        <footer class="footer" style="font-family:Consolas">
    <span class="copyright">
        Feily Zhang ©
        <script type="text/javascript">
            document.write(new Date().getFullYear());
        </script>
    </span>
    <span class="publish">Powered by <a href="http://www.chole.io/" target="_blank">Ink</a></span>
</footer>

        <script src="/bundle/index.js"></script>
    </body>
</html>
